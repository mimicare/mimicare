// ==========================================
// ENGAGEMENT - Notifications, Learning, Shopping
// ==========================================

// TODO: OFFLOAD TO DYNAMODB - Low read, notification state management
// Strategy: Single Table Design - PK=userId, SK=notificationType
model NotificationPreference {
  id        String   @id @default(nanoid()) @db.VarChar(21)
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  notificationType NotificationType

  enablePush     Boolean @default(true)
  enableEmail    Boolean @default(false)
  enableSMS      Boolean @default(false)
  enableWhatsApp Boolean @default(false)

  preferredTime  DateTime? @db.Time
  frequency      String?   @db.VarChar(50)
  isSmartEnabled Boolean   @default(true)

  @@unique([userId, notificationType])
  @@index([userId])
  @@map("notification_preferences")
}

model ContentReadLog {
  id        String   @id @default(nanoid()) @db.VarChar(21)
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  contentId       String
  contentTitle    String            @db.VarChar(500)
  contentCategory ContentCategory
  difficulty      ContentDifficulty

  readDuration     Int?
  completedReading Boolean @default(false)
  pointsEarned     Int     @default(0)

  readDuringLifeStage LifeStage?

  @@index([userId])
  @@index([contentCategory])
  @@map("content_read_logs")
}

model ShoppingListItem {
  id        String   @id @default(nanoid()) @db.VarChar(21)
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  itemName    String  @db.VarChar(255)
  category    String  @db.VarChar(100)
  quantity    Int     @default(1)
  isPurchased Boolean @default(false)

  estimatedCost Decimal?  @db.Decimal(10, 2)
  actualCost    Decimal?  @db.Decimal(10, 2)
  currency      String    @default("INR") @db.VarChar(3)
  purchasedAt   DateTime? @db.Date

  priority Int     @default(3)
  notes    String? @db.Text

  @@index([userId])
  @@index([isPurchased])
  @@map("shopping_list_items")
}

enum NotificationType {
  PILL_REMINDER
  OVULATION_ALERT
  PERIOD_PREDICTION
  APPOINTMENT_REMINDER
  VACCINE_DUE
  GROWTH_CHECKUP
  WATER_REMINDER
  EXERCISE_REMINDER
  CYCLE_IRREGULARITY
  PARTNER_ALERT
  PAYMENT_RECEIVED
  PAYOUT_PROCESSED
  GENERAL
}

enum NotificationChannel {
  PUSH
  EMAIL
  SMS
  WHATSAPP
}

// ===== CONTENT & LEARNING =====

enum ContentCategory {
  MENSTRUAL_HEALTH
  FERTILITY
  PREGNANCY
  POSTPARTUM
  CHILD_CARE
  MENOPAUSE
  NUTRITION
  MENTAL_HEALTH
  REPRODUCTIVE_DISORDERS
}

enum ContentDifficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}
